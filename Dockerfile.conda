FROM continuumio/miniconda3:latest

WORKDIR /app

# Install packages directly (not using environment.yml to avoid conda env overhead in Docker)
# This matches the dependencies specified in environment.yml
RUN conda install -y -c conda-forge -c defaults \
    python=3.13 \
    pyyaml \
    pandas \
    protobuf \
    flask=3.1.2 \
    gunicorn=23.0.0 \
    python-dotenv=1.2.1 \
    pyarrow \
    pip && \
    pip install openai==2.9.0 google-generativeai==0.8.5 chromadb==1.3.5 sentence-transformers==5.1.2 && \
    conda clean -afy

COPY . .

EXPOSE 5000

CMD ["gunicorn", "--bind", "0.0.0.0:5000", "app:app"]
