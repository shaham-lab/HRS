FROM continuumio/miniconda3:latest

WORKDIR /app

# Install packages directly (not using environment.yml to avoid conda env overhead in Docker)
# This matches the dependencies specified in environment.yml
RUN conda install -y -c conda-forge -c defaults \
    python=3.14.2 \
    pyyaml \
    pandas=2.3.3 \
    protobuf \
    flask=3.1.2 \
    gunicorn=23.0.0 \
    python-dotenv=1.2.1 \
    pyarrow \
    numpy=2.3.3 \
    matplotlib=3.10.7 \
    scikit-learn=1.7.2 \
    scipy=1.16.2 \
    pip && \
    pip install openai==2.9.0 google-generativeai==0.8.5 chromadb==1.3.5 sentence-transformers==5.1.2 \
    torch==2.9.1 stable-baselines3==2.8.0a2 torchvision==0.24.1 transformers==4.57.3 ucimlrepo==0.0.7 && \
    conda clean -afy

COPY . .

EXPOSE 5000

CMD ["gunicorn", "--bind", "0.0.0.0:5000", "src.app:app"]
